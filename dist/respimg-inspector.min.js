/*
 *	respimg-inspector - v0.2.2
 *	A javascript plugin to check responsive images in the browser.
 *	
 *
 *	Made by Florent Bourgeois
 *	Under MIT License
 */
!function(a,b,c){"use strict";var d,e={},f=!!(b.querySelector&&a.addEventListener&&a.MutationObserver&&a.Promise&&Array.prototype.map),g=!1,h=[],i=[],j=[],k={selectors:null,classNamespace:"respimg-inspector-"},l=["span","em","strong","i","b","big","small","tt","abbr","script","br","hr","sub","sup","button","input","label","select","textarea","samp","var","iframe","script","video","object","canvas","center","font","frame","frameset","noframe","noscript","option","strike","s","wbr","bdi","kbd","audio","map","area","track","embed","param","source","del","ins","acronym","applet","blink","dir","spacer","isindex","content","element","shadow","template","noembed","head","meta","link","title","style","html"],m=b.body,n=b.documentElement,o=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)},p=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},q=function(b,c,d){var e=d||a,f=function(){g||(g=!0,s.disconnect(),requestAnimationFrame(function(){e.dispatchEvent(new CustomEvent(c)),g=!1}))};e.addEventListener(b,f)},r=function(b,c){return a.getComputedStyle(b,null).getPropertyValue(c)},s=new MutationObserver(function(a){a.forEach(function(){u()})}),t=function(a){return new Promise(function(b,c){a.complete?b(a):(a.onload=function(){b(a)},a.onerror=function(){c()})})},u=function(){g=!0,C();var a=v(),c=b.querySelectorAll(a);o(c,function(a){var b=y(a);if(b){var c={el:a,img:b};"IMG"!==c.el.nodeName&&"cover"!==r(c.el,"background-size")||(h.push(c),i.push(b))}});var d=i.map(t);Promise.all(d).then(function(){o(h,function(a){var b=p(w(a.el),x(a.img));j.push(A(b)),s.observe(a.el,{attributes:!0})}),B(),s.observe(m,{childList:!0}),g=!1})},v=function(){if(d.selectors)return d.selectors;var a=l.map(function(a){return"not("+a+")"});return"*:"+a.join(":")},w=function(b){var c=b.getBoundingClientRect(),d=a.pageYOffset||n.scrollTop||m.scrollTop,e=a.pageXOffset||n.scrollLeft||m.scrollLeft,f=n.clientTop||m.clientTop||0,g=n.clientLeft||m.clientLeft||0;return{elTag:b.nodeName.toLowerCase(),elWidth:c.width,elHeight:c.height,elTop:Math.round(c.top+d-f),elBottom:Math.round(c.bottom+d-f),elLeft:Math.round(c.left+e-g),elRight:Math.round(c.right+e-g)}},x=function(a){return{imgWidth:a.width,imgHeight:a.height,imgNaturalWidth:a.naturalWidth,imgNaturalHeight:a.naturalHeight,imgSizes:a.sizes}},y=function(a){var b;if("IMG"===a.nodeName)b=a;else if("none"!==r(a,"background-image")){var c=/^url\((['"]?)(.*)\1\)$/.exec(r(a,"background-image"));c&&(b=new Image,b.src=c[2])}return b},z=function(b){var c,e=a.devicePixelRatio;return c=b.elWidth*e<b.imgNaturalWidth||b.elHeight*e<b.imgNaturalHeight?"warning":b.elWidth*e>b.imgNaturalWidth||b.elHeight*e>b.imgNaturalHeight?"bad":"good",d.classNamespace+c},A=function(a){var c=b.createElement("div");return c.classList.add(d.classNamespace+"overlay"),c.style.position="absolute",c.style.width=a.elWidth+"px",c.style.height=a.elHeight+"px",c.style.top=a.elTop+"px",c.style.left=a.elLeft+"px",c.style.zIndex=2147483647,c.classList.add(z(a)),o(a,function(a,b){c.dataset[b]=a}),c},B=function(){o(j,function(a){m.appendChild(a)})},C=function(){s.disconnect(),j.length&&o(j,function(a){a.remove()}),h=[],i=[],j=[]};e.init=function(b){return f?(d=p(k,b||{}),q("resize","optimizedResize"),a.addEventListener("optimizedResize",u,!1),void u()):void console.log("Unsupported browser... Sorry.")},e.destroy=function(){d&&(C(),a.removeEventListener("optimizedResize",u,!1))},"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.respImgInspector=e}(window,document);