/*
 *  responsive-images-test - v0.1.0
 *  A javascript plugin to check responsive images in the browser.
 *  
 *
 *  Made by Florent Bourgeois
 *  Under MIT License
 */
!function(a,b,c){"use strict";var d,e={},f=!!b.querySelector&&!!a.addEventListener&&!!a.MutationObserver,g={selectors:"img",classNamespace:"respimg-"},h=function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a))for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a);else for(var e=0,f=a.length;f>e;e++)b.call(c,a[e],e,a)},i=function(a,b){return a=JSON.parse(JSON.stringify(a)),Object.keys(b).map(function(c){Object.prototype.hasOwnProperty.call(a,c)&&(a[c]=b[c])}),a},j=function(b,c,d){var e=d||a,f=!1,g=function(){f||(f=!0,k.disconnect(),requestAnimationFrame(function(){e.dispatchEvent(new CustomEvent(c)),f=!1}))};e.addEventListener(b,g)},k=new MutationObserver(function(a){a.forEach(function(a){console.log("observer",a.type),m()})}),l=function(a,b){a.complete?b():a.addEventListener("load",function(){b()})},m=function(){k.disconnect(),q();var a=b.querySelectorAll(d.selectors);h(a,function(a){if("IMG"===a.tagName)n(a,p);else{if(!a.style.backgroundImage)return;o(a,p)}k.observe(a,{attributes:!0})}),k.observe(b.body,{childList:!0})},n=function(a,b){console.log("handleImgElement"),l(a,function(){console.log("handleImgElement","imageLoaded");var c=a.getBoundingClientRect(),d={elementWidth:c.width,elementHeight:c.height,elementTop:c.top,elementBottom:c.bottom,elementLeft:c.left,elementRight:c.right,imageWidth:a.width,imageHeight:a.height,imageNaturalWidth:a.naturalWidth,imageNaturalHeight:a.naturalHeight,imageSizes:a.sizes};b(d)})},o=function(a,b){console.log("handleBackgroundElement");var c=a.getBoundingClientRect(),d=/^url\((['"]?)(.*)\1\)$/.exec(a.style.backgroundImage),e=new Image(c.width,c.height);e.src=d[2],l(e,function(){console.log("handleBackgroundElement","imageLoaded");var a={elementWidth:c.width,elementHeight:c.height,elementTop:c.top,elementBottom:c.bottom,elementLeft:c.left,elementRight:c.right,imageWidth:e.width,imageHeight:e.height,imageNaturalWidth:e.naturalWidth,imageNaturalHeight:e.naturalHeight,imageSizes:e.sizes};b(a)})},p=function(a){console.log("renderOverlay");var c=b.createElement("div");c.classList.add(d.classNamespace+"overlay"),c.style.position="absolute",c.style.zIndex=2147483647,c.style.width=a.elementWidth+"px",c.style.height=a.elementHeight+"px",c.style.top=a.elementTop+"px",c.style.left=a.elementLeft+"px",a.imageWidth<a.imageNaturalWidth||a.imageHeight<a.imageNaturalHeight?c.classList.add(d.classNamespace+"warning"):a.imageWidth>a.imageNaturalWidth||a.imageNaturalHeight>a.imageNaturalHeight?c.classList.add(d.classNamespace+"bad"):c.classList.add(d.classNamespace+"good"),h(a,function(a,b){c.dataset[b]=a}),b.body.appendChild(c)},q=function(){console.log("removeOverlays");var a=b.querySelectorAll("."+d.classNamespace+"overlay");h(a,function(a){a.remove()})};e.init=function(b){console.log("init"),f&&(d=i(g,b||{}),j("resize","optimizedResize"),a.addEventListener("optimizedResize",m),m())},"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.respImgTest=e}(window,document);